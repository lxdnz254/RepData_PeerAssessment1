---
title: 'Reproducible Research: Peer Assessment 1'
output:
  html_document:
    keep_md: true
---
# Reproducible Research: Peer Assesment 1

This assesement assumes that the data file ("activity.zip") has already been downlaoded and is stored in the working directory before running knit2HTML to produce the assesment files.

## Loading and preprocessing the data

The following code unzips the data file then reads in the data to a datatable 
It then creates a 'time' column by extracting the given 'intervals' and converting them to 24 hour format.
Converting the date to class(POSIXct) also allows us to join together the date and time into one column 'datetime'

```{r, echo=TRUE}
library(data.table)
library(lubridate)
unzip("activity.zip")
data <- fread("activity.csv", stringsAsFactors = FALSE)
data$time <- substr(as.POSIXlt(sprintf("%04.0f", data$interval), 
                               format='%H%M'), 12, 16)
data$date <- ymd(data$date)
data$datetime <- ymd_hm(paste(data$date, data$time))
```


## What is mean total number of steps taken per day?

First arrange the data into groups by date and find the sum of each groups steps taken

```{r, echo=TRUE}
library(dplyr)
sdata <- data %>%
        group_by(date) %>%
        summarise(Totalsteps = sum(steps))
```

Produce histogram of total steps    
     
```{r,echo=TRUE}
hist(sdata$Totalsteps, main = "Daily Steps",
     xlab = "Total Daily Steps", col = "cyan")
```

Find mean and median

```{r,echo=TRUE}
summary <- function(x) {
        funs <- c(mean, median)
        lapply(funs, function(f) f(x, na.rm = TRUE))
}
meandat <- as.data.table(summary(sdata$Totalsteps))
setnames(meandat, 1:2, c("mean", "median"))
```

The mean is `r sprintf("%0.2f", meandat$mean)` and the median is `r meandat$median`.  
We can show that on the histogram by

```{r, echo=TRUE}
hist(sdata$Totalsteps, main = "Daily Steps",
     xlab = "Total Daily Steps", col = "cyan")
abline(v=mean(sdata$Totalsteps, na.rm=TRUE), col ="red")
abline(v=median(sdata$Totalsteps, na.rm=TRUE), col = "black", lty = 2)
legend("topright", legend = c("mean",
                              "median"), 
       lty = c(1,2), col = c("red", "black"))
```

But its hard to see if there is a difference between the mean and median lines.  
So we can zoom in for a closer look with

```{r,echo=TRUE}
hist(sdata$Totalsteps, main = "Daily Steps",
        xlab = "Total Daily Steps", col = "cyan", xlim = c(10760, 10770))
abline(v=mean(sdata$Totalsteps, na.rm=TRUE), col ="red")
abline(v=median(sdata$Totalsteps, na.rm=TRUE), col = "black", lty = 2)
legend("topright", legend = c("mean", "median"), 
               lty = c(1,2), col = c("red", "black"))
```

Now we can see there is a difference between mean and median.

## What is the average daily activity pattern?

First group the data by time and get the mean of each group

```{r,echo=TRUE}
tdata <- data %>%
        group_by(time) %>%
        summarise(Meansteps = mean(steps, na.rm=TRUE)) 
```

plot the data

```{r,echo=TRUE}
with(tdata, {plot(Meansteps~factor(time), type="l")
             lines(Meansteps~factor(time), type = "l")})
```

Find the maximum 5 minute interval

```{r,echo=TRUE}
maxt <- subset(tdata, tdata$Meansteps == max(tdata$Meansteps))
```

And we can see maximum time interval is `r maxt$time` at `r sprintf("%0.2f", max(tdata$Meansteps))` steps


## Imputing missing values



## Are there differences in activity patterns between weekdays and weekends?
